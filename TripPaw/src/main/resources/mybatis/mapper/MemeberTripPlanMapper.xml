<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssdam.tripPaw.memberTripPlan.MemberTripPlanMapper">

    <resultMap id="memberTripPlanResultMap" type="com.ssdam.tripPaw.domain.MemberTripPlan">
        <!-- ðŸ”¹ ë¨¼ì € id, result ìˆœì„œëŒ€ë¡œ ì„ ì–¸ -->
        <id property="id" column="id"/>
        <result property="titleOverride" column="title_override"/>
        <result property="publicVisible" column="is_public"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="status" column="status"/>
        <result property="countPeople" column="count_people"/>
        <result property="countPet" column="count_pet"/>
        <result property="createdAt" column="created_at"/>
        <result property="imageUrl" column="image_url"/>

        <!-- ðŸ”¹ ê·¸ ë‹¤ìŒì— association ì„ ì–¸ -->
        <association property="member" javaType="com.ssdam.tripPaw.domain.Member">
            <id property="id" column="member_id"/>
        </association>

        <association property="tripPlan" javaType="com.ssdam.tripPaw.domain.TripPlan">
            <id property="id" column="trip_plan_id"/>
        </association>
    </resultMap>

    <!-- âœ… ë‹¨ê±´ ì¡°íšŒ -->
    <select id="findById" parameterType="long" resultMap="memberTripPlanResultMap">
        SELECT *
        FROM member_trip_plan
        WHERE id = #{id}
    </select>

    <!-- âœ… ì‚¬ìš©ìž IDë¡œ ì „ì²´ ì¡°íšŒ -->
    <select id="findByMemberId" parameterType="long" resultMap="memberTripPlanResultMap">
        SELECT *
        FROM member_trip_plan
        WHERE member_id = #{memberId}
        ORDER BY created_at DESC
    </select>

    <!-- âœ… ì‚½ìž… -->
    <insert id="insert" parameterType="com.ssdam.tripPaw.domain.MemberTripPlan" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO member_trip_plan (
            member_id, trip_plan_id, title_override, is_public,
            start_date, end_date, status, count_people, count_pet,
            created_at, image_url
        ) VALUES (
            #{member.id}, #{tripPlan.id}, #{titleOverride}, #{publicVisible},
            #{startDate}, #{endDate}, #{status}, #{countPeople}, #{countPet},
            #{createdAt}, #{imageUrl}
        )
    </insert>

    <!-- âœ… ìˆ˜ì • -->
    <update id="update" parameterType="com.ssdam.tripPaw.domain.MemberTripPlan">
        UPDATE member_trip_plan
        SET
            title_override = #{titleOverride},
            is_public = #{publicVisible},
            start_date = #{startDate},
            end_date = #{endDate},
            status = #{status},
            count_people = #{countPeople},
            count_pet = #{countPet},
            image_url = #{imageUrl}
        WHERE id = #{id}
    </update>

    <!-- âœ… soft delete -->
    <delete id="delete" parameterType="long">
        UPDATE member_trip_plan
        SET member_id = 1
        WHERE member_id = #{id}
    </delete>

</mapper>
